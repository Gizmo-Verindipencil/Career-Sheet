import{Buildable}from"../interface/buildable.min.js";import{ThreadingUtility}from"../shared/utility/threading-utility.min.js";import ScriptSeriesLoader from"../shared/script-series-loader.min.js";class ExcelDownloader extends Buildable{constructor(){super(),this.scriptLoader=ScriptSeriesLoader,this.scriptLoader.add("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.2/xlsx.full.min.js"),this.scriptLoader.add("https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"),this.scriptLoader.load(),this.workbook={sheetNames:[],sheets:{}}}static build=async()=>{const e=new ExcelDownloader;for(;e.scriptLoader.running;)await ThreadingUtility.sleep(2e3);return e};addSheetToWorkbook=(e,t)=>{const o=t&&t.sheet?t.sheet:this.getDefaultSheetName();return this.workbook.sheetNames.push(o),this.workbook.sheets[o]=e,this.workbook};existsSheet=e=>this.workbook.sheetNames.filter((t=>t===e)).length>0;getDefaultSheetName=()=>{let e=1;for(;;){const t="Sheet"+e++;if(!this.existsSheet(t))return t}};addAoaToWorkbook=(e,t)=>this.addSheetToWorkbook(XLSX.utils.aoa_to_sheet(e,t),t);convertStringToArrayBuffer=e=>{for(var t=new ArrayBuffer(e.length),o=new Uint8Array(t),r=0;r!=e.length;++r)o[r]=255&e.charCodeAt(r);return t};download=e=>{if(!this.workbook||0===this.workbook.sheetNames.length)throw"Error: no content available.";const t={SheetNames:this.workbook.sheetNames,Sheets:this.workbook.sheets},o=XLSX.write(t,{type:"binary"}),r=this.convertStringToArrayBuffer(o),s=new Blob([r],{type:"application/octet-stream"});saveAs(s,`${e??"nameless-data"}.xlsx`)}}export{ExcelDownloader};