import{AbsoluteURIConverter}from"./absolute-uri-converter.min.js";import{Utility}from"./utility.min.js";class ScriptSeriesLoader{constructor(){this.sources=[],this.requiredObjects=[],this.importedSources=[],this.running=!1,this.absoluteURIConverter=new AbsoluteURIConverter;for(let e of document.getElementsByTagName("script"))e.src&&this.importedSources.push(e.src)}add=(e,s)=>{let t=e;this.absoluteURIConverter.isAbsoluteURI(t)||(t=this.absoluteURIConverter.convert(t)),this.sources.includes(t)||this.importedSources.includes(t)||(this.sources.push(t),s&&this.requiredObjects.push(s))};load=async(onSuccess,onFailure)=>{if(0===this.sources.length){for(;this.requiredObjects.some((x=>"undefined"===eval(`typeof ${x}`)));)await Threading.sleep(2e3);return this.running=!1,void(onSuccess&&onSuccess())}this.running=!0;const script=document.createElement("script");script.addEventListener("load",(()=>{this.load(onSuccess,onFailure)})),script.addEventListener("error",(e=>{onFailure&&onFailure(e)})),script.src=this.sources.shift(),document.head.appendChild(script),this.importedSources.push(script.src)}}export default new ScriptSeriesLoader;