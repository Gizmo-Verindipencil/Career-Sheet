import{WorkExperienceReportModel}from"../model/work-experience-report-model.min.js";import{Utility}from"../shared/utility.min.js";import ScriptSeriesLoader from"../shared/script-series-loader.min.js";import StylesheetSeriesLoader from"../shared/stylesheet-series-loader.min.js";class WorkExperienceReportController{constructor(){this.model=new WorkExperienceReportModel,this.stylesheetLoader=StylesheetSeriesLoader,this.stylesheetLoader.add("css/work-experience.min.css"),this.stylesheetLoader.load(),this.scriptLoader=ScriptSeriesLoader,this.scriptLoader.add("https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"),this.scriptLoader.load()}static build=async()=>{const e=new WorkExperienceReportController;for(;e.scriptLoader.running;)await Utility.sleep(2e3);return e};execute=()=>{const e=new URLSearchParams(document.location.search.substring(1)).get("no"),t=this.model.getWorkExperienceByNo(e);if(this.setPrevAndNextButtonAction(e),!t)return this.clearHeader(),void this.setNoDataNotification();this.setNo(t),this.setPeriod(t),this.setMonth(t),this.setTask(t),this.setSystem(t),this.setProjectPeakSize(t),this.setSubordinate(t),this.setTechnology(t),this.setPhase1(t),this.setPhase2(t),this.setPhase3(t),this.setPhase4(t),this.setPhase5(t),this.setPhase6(t),this.setPhase7(t),this.setPhase8(t),this.setDetail(t),this.setBusinessRelationshipChart(t)};setNo=e=>{$("input[name='number']").val(e.no)};setPeriod=e=>{const t=e=>(e=e.split("-"))[0]&&e[1]?`${e[0]}年${e[1]}月`:"????年??月",s=t(e.period.from);$("input[name='periodFrom']").val(s),$("input[name='periodBetween']").val("～");const r=t(e.period.to);$("input[name='periodTo']").val(r)};setMonth=e=>{if(!e.period.to)return;const t=Utility.getNumberOfDays(e.period.from);let s=(Utility.getNumberOfDays(e.period.to)-t)/30;s=0===s?.1:s,$("input[name='month']").val(s.toFixed(1))};setTask=e=>{$("input[name='task']").val(e.projectSummary)};setSystem=e=>{if(e.system&&0!==e.system.length||$("input[name='system']").val("-"),e.system.length>=1&&$("input[name='system']").val(e.system[0]),!(e.system.length<2))for(const t=1;t<e.length;t++){const s="work-experience-report-summary-item-value-task-and-system",r=`<input type="text" class="${"work-experience-summary-value"}" name="system${t}" value="${e.system[t]}"></input>`;$(s).after(r)}};setProjectPeakSize=e=>{$("input[name='projectPeakSize']").val(e.projectPeakSize)};setSubordinate=e=>{$("input[name='subordinate']").val(e.subordinate)};setTechnology=e=>{const t="work-experience-technology",s=(e,s)=>`<a class='${t}-${e}' href='../help/${e}.html' target='_blank'>${s}</p>`,r=[];r.push(s("device","機種")),r.push(s("operating-system","OS")),r.push(s("programming-language","言語")),r.push(s("development-tool","DT")),r.push(s("database","DB")),r.push(s("framework","FW")),r.push(s("platform","PF")),r.push(s("uncategorized","他")),$("#work-experience-report-summary-item-name-technology").empty(),$("#work-experience-report-summary-item-name-technology").append(r.join(""));const o=(e,s)=>`<p class='${t}-${e}'>${s}</p>`,a=(e,t)=>{if(!t||0===t.length)return;const s=t.filter(((e,t,s)=>s.indexOf(e)===t)),r=[];for(const t of s)r.push(o(e,t));return r.join("")},i=[];i.push(a("device",e.device)),i.push(a("operating-system",e.os)),i.push(a("programming-language",e.programmingLanguage)),i.push(a("development-tool",e.developmentTool)),i.push(a("database",e.db)),i.push(a("framework",e.framework)),i.push(a("platform",e.platform)),i.push(a("uncategorized",e.uncategorizedTechnology)),$("#work-experience-report-summary-item-value-technology").empty(),$("#work-experience-report-summary-item-value-technology").append(i.join(""))};setPhase=(e,t,s)=>{if(!e.task||0===e.task.length||!s||0===s.length)return void $(`input[name='phase${t}']`).val("");let r=[];for(const t of e.task)r=r.concat(t.type);for(const e of s){if(r.filter((t=>t===e)).length>0)return void $(`input[name='phase${t}']`).val("○")}$(`input[name='phase${t}']`).val("")};setPhase1=e=>{this.setPhase(e,1,[])};setPhase2=e=>{this.setPhase(e,2,["BA","SA","RD","E"])};setPhase3=e=>{this.setPhase(e,3,["FD","HLD"])};setPhase4=e=>{this.setPhase(e,4,["LLD"])};setPhase5=e=>{this.setPhase(e,5,["C","UT"])};setPhase6=e=>{this.setPhase(e,6,["IT"])};setPhase7=e=>{this.setPhase(e,7,["ST"])};setPhase8=e=>{this.setPhase(e,8,["SM","SO","HD"])};setPrevAndNextButtonAction=e=>{const t=t=>{const s=t?1:-1,r=`report.html?no=${Number(e)+s}`;window.location=r};$("button#work-experience-report-jump-prev").click((()=>t(!1)));$("button#work-experience-report-jump-next").click((()=>t(!0)))};clearHeader=()=>{$("input[name='number']").val(""),$("input[name='periodFrom']").val(""),$("input[name='periodBetween']").val(""),$("input[name='periodTo']").val(""),$("input[name='month']").val(""),$("input[name='task']").val(""),$("input[name='system']").val(""),$("input[name='projectPeakSize']").val(""),$("input[name='subordinate']").val(""),$("#work-experience-report-summary-item-name-technology").empty(),$("#work-experience-report-summary-item-value-technology").empty();for(let e=1;e<9;e++)$(`input[name='phase${e}']`).val("")};setDetail=e=>{$("#work-experience-report-detail").load(`${e.no}\\detail.html`)};setNoDataNotification=()=>{$("#work-experience-report-detail").html("<p>NO DATA</p>")};setBusinessRelationshipChart=e=>{const t=`<a class='work-experience-report-supplementary-link' href='${`../supplementary/business-relationship-chart.html?id=${e.businessRelationshipId}`}' target='_blank'>ビジネス関係図<img class='work-experience-report-supplementary-link-icon' src='../icon/top-to-right-arrow-in-box.svg'></a>`;$("#work-experience-report-supplementary").append(t)}}export{WorkExperienceReportController};